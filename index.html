<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EOS Fitness Tracker - Equipment Settings & Workout Manager</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="description" content="Track equipment settings, find substitutes, and manage workouts at EOS Fitness Lutz, Florida">
    <meta name="theme-color" content="#FF6B35">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="EOS Fitness">
    <meta name="application-name" content="EOS Fitness Tracker">
    <meta name="msapplication-TileColor" content="#FF6B35">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="shortcut icon" href="/favicon.ico">
</head>
<body>
    <!-- Skip to main content link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Main Header -->
    <header class="main-header">
        <div class="header-content">
            <h1>
                <svg class="logo" width="32" height="32" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                    <path d="M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm0 2c6.627 0 12 5.373 12 12s-5.373 12-12 12S4 22.627 4 16 9.373 4 16 4z"/>
                    <path d="M16 8c-2.21 0-4 1.79-4 4v8h2v-8c0-1.103.897-2 2-2s2 .897 2 2v8h2v-8c0-2.21-1.79-4-4-4z"/>
                    <path d="M10 14c-1.657 0-3 1.343-3 3s1.343 3 3 3h2v-2h-2c-.552 0-1-.448-1-1s.448-1 1-1h2v-2h-2zm10 0v2h2c.552 0 1 .448 1 1s-.448 1-1 1h-2v2h2c1.657 0 3-1.343 3-3s-1.343-3-3-3h-2z"/>
                </svg>
                <span>EOS Fitness Tracker</span>
            </h1>
            <div class="header-info">
                <div class="gym-info">
                <span class="gym-location">EOS Fitness Lutz, FL</span>
                <span class="tagline">Stronger Planning. Smarter Tracking.</span>
            </div>
                <div class="header-controls">
                    <div class="theme-controls">
                        <button id="theme-toggle" class="control-btn" aria-label="Toggle dark/light theme" title="Toggle theme">
                            <span class="theme-icon">üåô</span>
                        </button>
                        <button id="density-toggle" class="control-btn" aria-label="Toggle comfortable/compact view" title="Toggle density">
                            <span class="density-icon">‚öè</span>
                        </button>
                    </div>
                    <div class="user-status">
                        <span id="user-name" class="user-name hidden"></span>
                        <button id="auth-btn" class="auth-btn">Login</button>
                        <span id="sync-status" class="sync-status">
                            <span class="sync-indicator offline">‚óè</span>
                            <span class="sync-text">Offline</span>
                        </span>
                    </div>
                </div>
                <span id="last-updated" class="last-updated">Loading...</span>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav" aria-label="Main navigation">
        <button data-view="equipment" class="nav-btn active" aria-current="page">
            <span class="nav-icon">üèãÔ∏è</span>
            <span>Equipment</span>
        </button>
        <button data-view="workout" class="nav-btn">
            <span class="nav-icon">üìã</span>
            <span>Workout</span>
        </button>
        <button data-view="substitutes" class="nav-btn">
            <span class="nav-icon">üîÑ</span>
            <span>Substitutes</span>
        </button>
        <button data-view="history" class="nav-btn">
            <span class="nav-icon">üìä</span>
            <span>History</span>
        </button>
        <button data-view="settings" class="nav-btn">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </button>
    </nav>

    <!-- Main Content Container -->
    <main id="main-content" class="main-content">
        
        <!-- Equipment View -->
        <div id="equipment-view" class="view active">
            <!-- Search and Filters -->
            <div class="filters-section">
                <div class="search-bar">
                    <label for="search-input" class="sr-only">Search equipment</label>
                    <div class="search-input-container">
                        <input type="text" id="search-input" placeholder="Search equipment, muscles, or zones..." class="search-input" aria-describedby="search-hint">
                        <button id="clear-all-btn" class="clear-all-btn" title="Clear all filters and search">Clear all</button>
                    </div>
                    <div id="search-hint" class="sr-only">Search by equipment name, muscle groups, or zone letters A-F</div>
                </div>
                
                <!-- Active Filter Chips -->
                <div id="filter-chips-container" class="filter-chips-container hidden">
                    <span class="chips-label">Active filters:</span>
                    <div id="filter-chips" class="filter-chips"></div>
                </div>
                
                <div class="filter-groups">
                    <!-- Zone Filters -->
                    <fieldset class="filter-group">
                        <legend class="sr-only">Filter by gym zone</legend>
                        <label class="filter-label">Zone:</label>
                        <div class="filter-buttons">
                            <button class="zone-filter filter-btn active" data-zone="all" aria-pressed="true">‚úì All</button>
                            <button class="zone-filter filter-btn" data-zone="A" aria-pressed="false">A - EGYM</button>
                            <button class="zone-filter filter-btn" data-zone="B" aria-pressed="false">B - Hammer</button>
                            <button class="zone-filter filter-btn" data-zone="C" aria-pressed="false">C - Nautilus</button>
                            <button class="zone-filter filter-btn" data-zone="D" aria-pressed="false">D - Free</button>
                            <button class="zone-filter filter-btn" data-zone="E" aria-pressed="false">E - Cardio</button>
                            <button class="zone-filter filter-btn" data-zone="F" aria-pressed="false">F - Functional</button>
                        </div>
                    </fieldset>
                    
                    <!-- Muscle Group Filters -->
                    <fieldset class="filter-group">
                        <legend class="sr-only">Filter by target muscle group</legend>
                        <label class="filter-label">Muscle:</label>
                        <div class="filter-buttons">
                            <button class="muscle-filter filter-btn active" data-muscle="all" aria-pressed="true">‚úì All</button>
                            <button class="muscle-filter filter-btn" data-muscle="chest" aria-pressed="false">Chest</button>
                            <button class="muscle-filter filter-btn" data-muscle="back" aria-pressed="false">Back</button>
                            <button class="muscle-filter filter-btn" data-muscle="shoulders" aria-pressed="false">Shoulders</button>
                            <button class="muscle-filter filter-btn" data-muscle="legs" aria-pressed="false">Legs</button>
                            <button class="muscle-filter filter-btn" data-muscle="arms" aria-pressed="false">Arms</button>
                            <button class="muscle-filter filter-btn" data-muscle="core" aria-pressed="false">Core</button>
                        </div>
                    </fieldset>
                </div>
            </div>

            <!-- Equipment Grid -->
            <div id="equipment-list" class="equipment-grid">
                <!-- Equipment cards will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Workout Builder View -->
        <div id="workout-view" class="view hidden">
            <div id="workout-content" class="view-content">
                <!-- Workout builder content will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Substitutes View -->
        <div id="substitutes-view" class="view hidden">
            <div id="substitutes-content" class="view-content">
                <!-- Substitutes content will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- History View -->
        <div id="history-view" class="view hidden">
            <div id="history-content" class="view-content">
                <!-- History content will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Settings View -->
        <div id="settings-view" class="view hidden">
            <div id="settings-content" class="view-content">
                <!-- Settings content will be inserted here by JavaScript -->
            </div>
        </div>
    </main>

    <!-- Status Bar -->
    <div id="status-bar" class="status-bar">Ready</div>

    <!-- Modals -->
    <!-- Equipment Detail Modal -->
    <div id="equipment-modal" class="modal">
        <div class="modal-content">
            <!-- Modal content will be inserted by JavaScript -->
        </div>
    </div>

    <!-- Substitutes Modal -->
    <div id="substitutes-modal" class="modal">
        <div class="modal-content">
            <!-- Modal content will be inserted by JavaScript -->
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="auth-title">
        <div class="modal-content auth-modal">
            <div class="modal-header">
                <h2 id="auth-title">Welcome to EOS Fitness Tracker</h2>
                <button class="modal-close" data-action="close-auth-modal" aria-label="Close authentication dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div id="auth-register" class="auth-form">
                    <h3>Create Your Account</h3>
                    <p>Get started with secure cloud storage for your workout data.</p>
                    <form id="register-form">
                        <div class="form-group">
                            <label for="user-name-input">Your Name:</label>
                            <input type="text" id="user-name-input" name="userName" placeholder="Enter your name" required>
                        </div>
                        <button type="submit" class="btn-primary">Create Account</button>
                    </form>
                    <p class="auth-switch">
                        Already have an account? <button type="button" class="link-button" data-action="switch-to-login">Login instead</button>
                    </p>
                </div>
                
                <div id="auth-login" class="auth-form hidden">
                    <h3>Login to Your Account</h3>
                    <p>Enter your User ID to access your workout data.</p>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="user-id-input">User ID:</label>
                            <input type="text" id="user-id-input" name="userId" placeholder="user-1234567890-abc123" required>
                            <small class="form-help">Your User ID starts with "user-" followed by numbers and letters</small>
                        </div>
                        <button type="submit" class="btn-primary">Login</button>
                    </form>
                    <p class="auth-switch">
                        Don't have an account? <button type="button" class="link-button" data-action="switch-to-register">Create one</button>
                    </p>
                </div>
                
                <div id="auth-loading" class="auth-loading hidden">
                    <div class="loading-spinner"></div>
                    <p>Setting up your account...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Keyboard Help Modal -->
    <div id="keyboard-help-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="keyboard-help-title">
        <div class="modal-content keyboard-help-modal">
            <div class="modal-header">
                <h2 id="keyboard-help-title">Keyboard Shortcuts</h2>
                <button class="modal-close" data-action="close-keyboard-help" aria-label="Close keyboard shortcuts dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-group">
                        <h3>Navigation</h3>
                        <div class="shortcut-item">
                            <kbd>/</kbd>
                            <span>Focus search input</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Escape</kbd>
                            <span>Clear search or close modals</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>?</kbd>
                            <span>Show this help dialog</span>
                        </div>
                    </div>
                    
                    <div class="shortcut-group">
                        <h3>Zone Filters</h3>
                        <div class="shortcut-item">
                            <kbd>1</kbd>
                            <span>Zone A (EGYM)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>2</kbd>
                            <span>Zone B (Hammer)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>3</kbd>
                            <span>Zone C (Nautilus)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>4</kbd>
                            <span>Zone D (Free Weights)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>5</kbd>
                            <span>Zone E (Cardio)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>6</kbd>
                            <span>Zone F (Functional)</span>
                        </div>
                    </div>
                    
                    <div class="shortcut-group">
                        <h3>Equipment Cards</h3>
                        <div class="shortcut-item">
                            <kbd>Tab</kbd>
                            <span>Navigate through cards and buttons</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Enter</kbd>
                            <span>Activate buttons or open details</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Space</kbd>
                            <span>Activate buttons</span>
                        </div>
                    </div>
                </div>
                
                <div class="keyboard-help-footer">
                    <p><strong>Note:</strong> Keyboard shortcuts work when no input fields are focused and no modals are open.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Migration Modal -->
    <div id="migration-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="migration-title">
        <div class="modal-content migration-modal">
            <div class="modal-header">
                <h2 id="migration-title">Upgrade to Cloud Storage</h2>
                <button class="modal-close" data-action="close-migration-modal" aria-label="Close migration dialog">&times;</button>
            </div>
            <div class="modal-body">
                <div id="migration-intro" class="migration-step">
                    <h3>üöÄ Welcome to the new secure version!</h3>
                    <p>We found your existing workout data. Let's migrate it to secure cloud storage so you can access it from any device.</p>
                    <div class="migration-benefits">
                        <div class="benefit-item">
                            <span class="benefit-icon">üîê</span>
                            <span>Secure encrypted storage</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-icon">üì±</span>
                            <span>Cross-device synchronization</span>
                        </div>
                        <div class="benefit-item">
                            <span class="benefit-icon">‚òÅÔ∏è</span>
                            <span>Automatic cloud backup</span>
                        </div>
                    </div>
                    <button id="start-migration" class="btn-primary">Start Migration</button>
                    <button id="skip-migration" class="btn-secondary">Continue Without Migration</button>
                </div>
                
                <div id="migration-progress" class="migration-step hidden">
                    <h3>Migrating Your Data...</h3>
                    <div class="progress-bar">
                        <div id="migration-progress-fill" class="progress-fill"></div>
                    </div>
                    <p id="migration-status">Preparing migration...</p>
                </div>
                
                <div id="migration-complete" class="migration-step hidden">
                    <h3>‚úÖ Migration Complete!</h3>
                    <p>Your workout data has been successfully moved to secure cloud storage.</p>
                    <div id="migration-summary" class="migration-summary"></div>
                    <button id="continue-to-app" class="btn-primary">Continue to App</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container" aria-live="polite" aria-atomic="false"></div>
    
    <!-- Screen Reader Announcements -->
    <div id="sr-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <!-- Hidden File Input for Import -->
    <input type="file" id="import-file-input" accept=".json" class="hidden">

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <p>EOS Fitness Tracker v2.0 | Personal Equipment Settings Manager</p>
            <p class="footer-links">
                <button type="button" class="link-button" data-action="export-data">Export Data</button> |
                <button type="button" class="link-button" data-action="show-settings">Settings</button> |
                <button type="button" class="link-button" data-action="show-keyboard-help">Keyboard Shortcuts</button> |
                <button type="button" class="link-button" data-action="show-about">About</button>
            </p>
        </div>
    </footer>

    <!-- Load Modular JavaScript -->
    <script type="module" src="src/app/index.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('ServiceWorker registered successfully:', registration.scope);
                    
                    // Handle updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content is available, prompt user to refresh
                                    showUpdateAvailableNotification();
                                }
                            });
                        }
                    });
                    
                    // Listen for controlling service worker changes
                    let refreshing = false;
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        if (!refreshing) {
                            refreshing = true;
                            window.location.reload();
                        }
                    });
                    
                } catch (error) {
                    console.error('ServiceWorker registration failed:', error);
                }
            });
        }
        
        // Show update notification
        function showUpdateAvailableNotification() {
            if (window.showNotification) {
                window.showNotification(
                    'Update Available',
                    'A new version of the app is available. Refresh to update.',
                    'info',
                    8000,
                    [{
                        text: 'Refresh Now',
                        action: () => {
                            navigator.serviceWorker.controller?.postMessage({ type: 'SKIP_WAITING' });
                        }
                    }]
                );
            }
        }
    </script>
</body>
</html>